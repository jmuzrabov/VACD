<!DOCTYPE html>
<html>
<head>
	<title>VACD</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" type="image/png" sizes="32x32" href="meta/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="meta/favicon-16x16.png">
	<link rel="icon" type="image/png" href="meta/favicon.ico">
	<link rel="mask-icon" href="meta/safari-pinned-tab.svg" color="#ce470a">
	<link rel="stylesheet" type="text/css" href="css/_plug/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/forms.css">
	<link rel="stylesheet" type="text/css" href="css/yd.css">
	<link rel="stylesheet" type="text/css" href="css/buttons.css">
	<script src="https://code.iconify.design/1/1.0.7/iconify.min.js"></script>

	<style>
		table,
		th,
		td {
			/* border: 1px solid black; */
			border-collapse: collapse;
			width: 100%;
		}
		#rete{
			overflow: hidden;
			touch-action: none;
			width: 100% !important;
			min-height: 75vh;
		}

		#buttons,.buttons{
			display: flex;
			justify-content: start;
			flex-direction: row;
			width: 100%;
		}
		.node .red {
			background: red;
		}
		.extBtn{
			display: flex;
			flex-direction: column;
			justify-content: space-between;
			align-content: stretch;
		}
		/*#extBtn input:first-child{
			margin-right: 10px;
		} */
		.saveBtn,.hinzufuegenBTN{
			display: flex;
			justify-content: center;
			align-items: center;
			margin-top: 10px;
		}
		.smallmsg{
			position: absolute;
			left: auto;
			right: auto;
			top: 60px;
			margin-left: 5px;
		}
		.progress-bar{
			margin-top: 10px;
			height: 35px;
		}
		.progress-bar-fill{
			height: 100%;
			width: 0%;
			background: lightblue;
			display: flex;
			align-items: center;
			transition: width 0.25s;
		}
		.progress-bar-text{
			margin-left: 5px;
			font-weight: bold;

		}
		#dropZone{
			border: 3px dashed #fd7e14;
			padding: 10px;
			width: 100%;
			height: auto;

		}
		#dropZone>span{
			display: block;
			text-align: center;
			color: #244669;
		}
		#dropZone>span,
		#fileUPLOAD{
			height: 35px;
			line-height: 35px;
			color: #244669;
		}
		#files{
			border:1px dotted #0088cc;
			padding:20px;
			width:100%;
			display: none;
		}
		#fileUPLOAD{
			position: relative;
			opacity: 1;
			filter: alpha(opacity=1);
			width: 100%;

		}
		#error{
			color:red;
			margin-top:10px;
		}
		#progress{
			height: 100%;
			width: 0%;
			background: lightblue;
			display: flex;
			align-items: center;
			transition: width 0.25s;
		}
		#inputFILE{
			position: relative;
			opacity: 1;
			filter: alpha(opacity=0);
			width: 100%;
			height: 35px;
			line-height: 35px;
		}
		#ausgabe ul{
			list-style: none;
		}
		#ausgabe ul li input{
			margin-right: 10px;
		}
		#ausgabe label,
		#ausgabe small{
			display: inline-block;
			margin-left: 15px;
		}

		#resultat select{
			width: 200px;
		}
		#del>svg{
			cursor: pointer;
			display: block;
			margin-bottom: 1em;
		}
		#zettel li{
			display: flex;
			justify-content: left;
			flex-direction: row;
			align-content: normal;
			align-items: center;
			align-content: center;
			}
		#zettel li span{
			width: 15%;
		}
		label.delet{
			background-image:url(./icons/delete.svg);
			width: 1em;
			height: 1em;
			cursor: pointer;
		}
	</style>

</head>
<body translate="no">
	<article class="row no-gutters">
		<aside class="col-auto">
			<a href="/" class="logo bone"><div></div></a>
			<nav class="bone mb-5" id="back">
				<!-- <a href="menu.html"  >zurück</a> -->
			</nav>
			<nav class="bone" id="nav">
				<a href="#" id="telNumber" >Nummer</a>
				<a href="#" id="callflow" class="hidden">Callflow</a>
				<a href="#" id="sound" class="hidden" >Sounds</a>
			</nav>
			<footer>
				<nav class="bone">
					<!-- <a href="#" id="test">TEST</a> -->
					<a href="#" id="generator">Generate</a>
				</nav>

				<small  id="logout">
					<a href="index.html">abmelden
						<!-- <img src="//assets.yoummday.com/icons/mdi-reload.svg?color=%23eb6608" style="width:16px;"> -->
					</a>
				</small>
			</footer>
		</aside>
		<div class="col row no-gutters flex-column">
			<header class="bone text-center">
				<div class="row">
					<div class="container p-2">
						<div class="row justify-content-between">
					    <div class="col-4">
					      <span class="font-weight-bold text-uppercase "><label id="custom" ></label></span>
								<!-- <span class="iconify" data-icon="mdi:arrow-left-bold-circle-outline" data-inline="false"></span> -->
					    </div>
					    <div class="col-4">
					      <span class="font-weight-bold text-uppercase" id="head"><label for="worktype_label" id="worktype_label"></label></span>
					    </div>
					  </div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-8"></div>
				</div>
			</header>
			<div class="content col">

				<!-- Editor und Anrufverlaufliste -->
				<div class="row justify-content-around editorbox">

					<!-- Leftsite / Editor -->
					<div class="card col-sm-6 col-md-9" id="leftSite">

							<div class="card-body">
								<!-- Telefonnummerliste und Sound upload-->
								<div class="row">
										<!-- Number und Anrufverlaufliste-->
										<div class=" hidden col" id='number'>
											<h2>Add Phonenumber to Callflow </h2>
											<!-- <div class=" justify-content-around" > -->
												<div class="row">
											    <div class="col-md-6" id="resultat">
														<table border="1">
															<tr>
																<th>Telefonnummer</th><th>Callflowname</th>
															</tr>
														</table>
													</div><!-- #resultat -->
											  </div>
												<div class="row">
													<div class="col">
														<h3 class="mt-5">Auftrag</h3>
														<div class="col" id="liste">
															<ul id="zettel"></ul>
															<!-- <form> -->
																<div class="row">
																	<div class="col-md-3" id="telNr"></div>
																	<div class="col-md-3" id='graphNAME'></div>
																	<div class="col-md-3" id="del"></div>
																</div>
															<!-- </form> -->
														</div>
													</div>
												</div><!-- row -->
												<div class="row mt-5">
													<div class="col-md-3" id='divTELNUMMER'>
																<label for="selectTELNUMMER">Telfonnummer:</label>
																<select id="selectTELNUMMER" size="">
																	<option value="#" selected>--</option>
																</select>
													</div><!-- divTELNUMMER-->

													<div class="col-md-3" id="divGRAFIKLIST">
														<label for="grafikLIST2">Callflow</label>
														<select id="grafikLIST2" class="grafikLIST2" name="grafikLIST2" ></select>
													</div><!-- divGRAFIKLIST-->

													<div class="col-md-3" id="divHinzuBtn" style="display: flex;align-items: center;">
														<input type="submit" class="btn btn-small btn-primary mt-3" id="hinzu" value="speichern" />
													</div>

												</div>
											<!-- </div> -->
										</div><!--id='number'-->

									<!-- Sound upload-->
									<div class="col hidden" id='divSOUNDUPLOAD' >
										<div class="justify-content-around ">
											<div class="col" id="divSOUNDLIST">
												<h3>Sounds</h3>
												<div id="ausgabe">
													<form>
														<ul></ul>
														<input type="submit" class="button btn btn-primary" value="DELETE" id="deleteBtn">
													</form>
												</div>
											</div><!-- divSOUNDLIST-->

											<div class="col extBtn mt-5">
												<form id="uploadFORM" enctype='multipart/form-data'>
													<input type="file" name="file" value="" id="inputFILE"><br>
													<div class="justify-content-between">
														<input type="button" class="button btn btn-primary" value="UPLOAD" id="btnUPLOAD">
													</div>
												</form>
											</div><!-- soundUPLOAD-->
										</div>
									</div>
								</div><!-- id='divSOUNDUPLOAD' -->
								<!-- Editor -->
								<div id="rete" class="hidden"></div>
							</div>
					</div>

					<!-- Rightsite / Editor -->
					<div class="card hidden col-4 col-md-3 p-3" id="rightSite" >
							<!-- Anrufverlaufliste und neue Grafikname-->
							<div class="card-body justify-content-around">
								<div class="col" id="divGRAFIKLIST">
										<label for="grafikLIST1">Callflow</label>
										<select id="grafikLIST1" class="grafikLIST1" name="grafikLIST1" >
											<option value="#">--</option>
										</select>
									</div><!-- divGRAFIKLIST-->
								<div class="col" id="divGRAFIKNAME">
												<label for="neueGRAFIKNAME">Callflowname:</label>
												<input type="text" name="neueGRAFIKNAME" id="neueGRAFIKNAME" value=""/>
												<p class="smallmsg"><small id="smallmsg"></small></p>
												<input type="button" class="btn btn-small btn-primary mt-3 mb-3" id="save" value="speichern" />
												<input type="button" class="button btn btn-primary" value="löschen" id="graphLOESCHEN">
									</div><!-- divGRAFIKNAME-->
								<div class="col" id="graphInfo">
									<ul></ul>
								</div>
							</div>
						</div>

					<!-- Buttom Site -->
					<div class="row hidden" id="editorBtn">
							<!-- Editor Buttons-->
							<div id="buttons"></div>
						</div>

				</div>


				<div class="row justify-content-around">
					<div class="text">
						<div id="out" class="mb-3"></div>

					</div><!-- text-->
				</div>
			</div>
		</div>
		<div class="modal d-none" tabindex="-1">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header">
		        <h5 class="modal-title alert-warning">ACHTUNG!</h5>
		        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
		          <span aria-hidden="true">&times;</span>
		        </button>
		      </div>
		      <div class="modal-body">
		        <p>Wollen Sie wirklich löschen?</p>
		      </div>
		      <div class="modal-footer">
		        <button type="button" class="btn btn-outline-primary" data-dismiss="modal">nein</button>
		        <button type="button" class="btn btn-outline-primary" id="ja">ja</button>
		      </div>
		    </div>
		  </div>
		</div>
	</article>

	<script src="./js/rete.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.6/vue.min.js"></script>
	<script src="./js/vue-render-plugin.min.js"></script>
	<script src="./js/connection-plugin.min.js"></script>
	<script src="./js/alight.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.min.js"></script>
	<script src="./js/context-menu-plugin.min.js"></script>
	<script src="./js/area-plugin.min.js"></script>
	<script src="./js/comment-plugin.min.js"></script>
	<script src="./js/history-plugin.min.js"></script>
	<script src="./js/connection-mastery-plugin.min.js"></script>
	<script src="./js/jquery-3.5.1.js"></script>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script src="./js/jq/vendor/jquery.ui.widget.js"></script>
	<script src="./js/jq/jquery.iframe-transport.js"></script>
	<script src="./js/jq/jquery.fileupload.js"></script>
	<script src="./js/dayjs.min.js"></script>

	<script type="text/javascript">

		$(document).ready(function(){
			//aktulle Uhrzeit
			// var currentdate = new Date();
			//
			// //aktuelle Uhrzeit formatieren
    	// var datetime =currentdate.getDate() + "." + (currentdate.getMonth()+1)  + "." + currentdate.getFullYear() + "  "
      //           	+ currentdate.getHours() + ":" + currentdate.getMinutes() + ":" + currentdate.getSeconds();
			//
			// //graphlist Daten
			// var graphObj;
			// var graphObj1;
			// var soundObj;
			// var telnummObj;
			// //Aktuelle Uhrzeit
			// function showTime(){
			// 	// var dayName =
			// 	var date = new Date();
			// 	var day = date.getDate();
			// 	var month = (date.getMonth()+1);
			// 	var year = date.getFullYear();
			// 	var h = date.getHours();
			// 	var m = date.getMinutes();
			// 	var s = date.getSeconds();
			//
			// 	if(h == 0){
			// 		h = 12;
			// 	}
			// 	if(h == 0){
			// 		h = h-12;
			// 	}
			//
			// 	h = (h < 10)? '0' + h : h;
			// 	m = (m < 10)? '0' + m : m;
			// 	s = (s < 10)? '0' + s : s;
			//
			// 	var time = day + '.' + month + '.' + year + '  ' + h + ':' + m + ':' + s ;
			// 	var timeLabel = $('#worktype_label');
			// 	timeLabel.append(time);
			// }
			// showTime();
			// setTimeout(showTime, 1000);
			// function showTime(){
			// 	var currentDateTime = dayjs().format('DD.MM.YYYY hh:mm');
			// 	                var timeLabel = $('#worktype_label');
			// 	                timeLabel.append(currentDateTime);
			// 	}
			// 	showTime();
			//Click EVENTS

			//Anrufverlaufliste/gespeicherte Grafik im Editor anzeigen
			$.ajax({
					type: 'GET',
					contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
					dataType: "json",
					data:
					{
						auth: window.localStorage.getItem("auth"),
						couser: window.localStorage.getItem("couserID")
					},
					url: 'https://apiqa.yoummday.com/vacd/graphlist',
					success: function(result){
						// console.log('graphObj=>',graphObj);
						console.log('graphlist=>',result);
						delete result["authTime"];
						delete result["success"];

						if(Object.keys(result).length > 0) {

							Object.keys(result).forEach(key => {

								if(Object.keys(result[key])){
									Object.keys(result[key]).forEach(i => {
										// console.log('result[key][i]=>',result[key][i]);
										// console.log('result[key][i]["name"]=>',result[key][i]['name']);
										$("#grafikLIST1").append('<option value='+ result[key][i]["id"] + '>' + result[key][i]["name"] + '</option>');
										// $("#grafikLIST2").append('<option value='+ result[key][i]["id"] + '>' + result[key][i]["name"] + '</option>');
									}//Object.keys

								)}//if

								//Anrufverlaufliste/gespeicherte Grafik im Editor anzeigen
								$("#grafikLIST1").change(function(){

									$('#grafikLIST1 option:selected').each(function(){

										if(result[key]){

											Object.keys(result[key]).forEach(i => {
												if(i === this.value){

												let graphObjID = result[key][i].id;
												let graphObjNAME = result[key][i].name;
												let graphObjJSON = result[key][i].json;
												// console.log(result[key].json);
												let json = result[key][i].json;
												$('#graphInfo ul').empty();
												editor.fromJSON( JSON.parse(json));
												$('#graphInfo ul').append('<li>ID:<small><i> ' + graphObjID + '</i></small></li>' + '<li>Name:<small><i> ' + graphObjNAME + '</i></small></li>'+ '<li>JSON:<small><i> ' + graphObjJSON + '</i></small></li>');

											}//if(i === this.value)
											});//Object.keys(result[key]).forEach
										}//if(result[key]

										$.ajax({
												type: 'GET',
												contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
												dataType: "json",
												data:
												{
													auth: window.localStorage.getItem("auth"),
													couser: window.localStorage.getItem("couserID")
												},
												url: 'https://apiqa.yoummday.com/vacd/soundlist',
												success: function(result){

													console.log('soundlist=>',result);
													delete result["authTime"];
													delete result["success"];

													let ausgabe = $('#ausgabe');
													let ausgabeUL = $('#ausgabe ul');
													ausgabeUL.empty();
													if(Object.keys(result).length > 0) {

														Object.keys(result).forEach(key => {
															if(Object.keys(result[key])){
																Object.keys(result[key]).forEach(index =>{
																	if(result[key][index]['filename']){
																		let fieleID = result[key][index]["id"];
																		let fileName = result[key][index]["filename"];
																		let fileTS = result[key][index]["uploadTS"];
																		// console.log(fileName);
																		let select = $('#soundlist');
																		// console.log(select);
																		select.append('<option value="' + fieleID + '">' + fileName + '</option>');

																		// ausgabeUL.append('<li><input type="checkbox" name="' + fieleID + '" value="' + fileName + '"><label for="'+ fieleID + '"> '+ fileName + '</label><i><small>' + fileTS +'</small></i></li>');

																	}else{
																		// $("#soundLIST").append('<option value='+ result[key][index]["id"] + '>' + 'keine Name' + '</option>');
																	}

																});//Object.keys(result[key]).forEach
															}//if
														});//Object.keys(result)
													}


												},
												error: function(error){
													console.log(error);
												}
											});//$.ajax

									});//$('#grafikLIST option:selected')
								});//$("#grafikLIST")



							});//Object.keys(result)
						}//if(Object.keys(result).length > 0)
					},//success: function(result)
					error: function(error){
						console.log(error);
					}
				});//$.ajax
			//couserlist Daten
			$.ajax({
				type: 'POST',
				contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
				dataType: "json",
				data:{
					auth: localStorage.auth,
					couser: localStorage.couserID
						},
				url: 'https://apiqa.yoummday.com/vacd/couserslist',
				success: function(data){
					delete data["authTime"];
					delete data["success"];
					console.log('couserlist=>',data);
					// console.log('data.couserlist=>',data.couserlist);
					// console.log('name=>',localStorage.name);
					let span = document.createElement('span');
					let timeLabel = $('#worktype_label');
					// span.setAttribute('class','clock');
					// span.setAttribute('data-tz','Europe/Berlin');
					// span.append(datetime);
					// timeLabel.append(span);


					let header = $('#custom');
					let a = document.createElement('a');
					let divBack = $('#back');
					let aBack = document.createElement('a');

					let backSpan = document.createElement('span');
					backSpan.setAttribute('class','iconify');
					backSpan.setAttribute('data-icon','mdi:arrow-left-bold-circle-outline');
					backSpan.setAttribute('data-inline','false');
					backSpan.setAttribute('data-width','20px');
					backSpan.setAttribute('data-height','20px');
					backSpan.setAttribute('style','color:#eb6608');
					backSpan.setAttribute('style','margin-right:5px');
					let backA = document.createElement('a');

					if(window.localStorage.getItem('couserNAME')){

						a.setAttribute('href','#');
						a.appendChild(document.createTextNode(window.localStorage['couserNAME']));

						backA.setAttribute('href','menu.html');
						backA.appendChild(backSpan);

					}else{
						a.appendChild(document.createTextNode(window.localStorage['name']));
						// a.appendChild(document.createTextNode('Firma hat keine Name'));
					}
						header.append(a);
						header.append(backA);


					//
					// if(Object.keys(data).length > 0) {
					//
					// 		Object.keys(data).forEach(key => {
					// 		if(Object.keys(data[key].length > 0)){
					// 			Object.keys(data[key]).forEach(index => {
					// 				// console.log('index=>',index);
					// 				// console.log('data[key][index]=>',data[key][index]);
					// 				let content = $('.content');
					// 				let colSm6 = document.createElement('div');
					// 				colSm6.setAttribute('class','col-sm-6');
					// 				let cardFlexFill = document.createElement('div');
					// 				cardFlexFill.setAttribute('class','card');
					// 				let cardBody = document.createElement('div');
					// 				cardBody.setAttribute('class','card-body card_body_box');
					// 				cardBody.setAttribute('id',index);
					// 				let row = document.createElement('div');
					// 				row.setAttribute('class','row');
					//
					// 				let colAuto1 = document.createElement('div');
					// 				colAuto1.setAttribute('class','col-auto');
					// 				let thumb = document.createElement('div');
					// 				thumb.setAttribute('class','thumb-45px rounded-circle alert-info border-light');
					// 				thumb.setAttribute('style','background-image:url(http://placehold.it/100x100)');
					// 				colAuto1.append(thumb);
					//
					// 				let col = document.createElement('div');
					// 				col.setAttribute('class','col');
					// 				// col.setAttribute('id','subClients');
					// 				let h4 = document.createElement('h4');
					// 				let span = document.createElement('span');
					// 				let small = document.createElement('small');
					// 				let hr = document.createElement('hr');
					//
					//
					// 				let colAuto2 = document.createElement('div');
					// 				colAuto2.setAttribute('class','col-auto');
					// 				let dropme = document.createElement('div');
					// 				dropme.setAttribute('class','dropme');
					// 				dropme.setAttribute('tabindex','1');
					// 				let a = document.createElement('a');
					// 				a.setAttribute('href','#');
					// 				let span2 = document.createElement('span');
					// 				span2.setAttribute('class','iconify rounded-circle');
					// 				span2.setAttribute('data-icon','mdi-menu');
					// 				span2.setAttribute('data-inline','false');
					// 				a.append(span2);
					// 				dropme.appendChild(a);
					// 				colAuto2.append(dropme);
					//
					//
					// 				span.setAttribute('class','clock');
					// 				span.setAttribute('data-tz','Europe/Berlin');
					// 				// span.append(datetime);
					// 				h4.appendChild(document.createTextNode(data[key][index]));
					// 				col.append(h4);
					// 				col.append(span);
					// 				col.append(small);
					// 				col.append(hr);
					//
					// 				row.append(colAuto1);
					// 				row.append(col);
					// 				row.append(colAuto2);
					//
					// 				cardBody.append(row);
					// 				cardFlexFill.append(cardBody);
					// 				colSm6.append(cardFlexFill);
					// 				content.append(colSm6);
					//
					// 			});//Object.keys(data[key])
					// 		}
					//
					// 		});//	Object.keys(data)
					// 		// <span class="clock" data-tz="Europe/Berlin">Mo 19:10</span>
					// 		// <div class="thumb-45px rounded-circle alert-info border-light" style="background-image:url(https://media.yoummday.com/qa/971/ppl9LJsbxk25wc.jpg)">	</div>
					// 		$('.card_body_box').click(function(){
					// 			console.log(this);
					// 			let auth = window.localStorage['auth'];
					// 			let couserID = this.id;
					// 			console.log(couserID);
					// 			$.ajax({
					// 				type:'POST',
					// 				contentType:'application/x-www-form-urlencoded; charset=UTF-8',
					// 				dataType:'json',
					// 				data:{
					// 					auth: auth,
					// 					couser: couserID
					// 				},
					// 				url:'https://apiqa.yoummday.com/vacd/numberlist',
					// 				success: function(data){
					// 					delete data["authTime"];
					// 					delete data["success"];
					// 					console.log('data=>',data);
					// 					window.localStorage.setItem('couserID',couserID);
					// 					window.location.href = '/VACD/reteflow.html';
					// 					// window.localStorage.removeItem('couserID');
					// 				}//success:function
					// 			});//$.ajax
					// 		});//	$('#nav a').click(function()
					//
					//
					// }//Object.keys(data)
					// $('.dropme>a').on('click',function(){
					// 	console.log('test');
					// });
					let aMenu1 = $('#callflow');
					let aMenu2 = $('#sound');
					let couserLenght = window.localStorage['couserLenght'];
					let fullaccess = window.localStorage['fullaccess'];

					if(couserLenght > 1 || fullaccess === true){
						aMenu1.removeClass('hidden');
						aMenu2.removeClass('hidden')
					}


				},//success
				error: function(error){
					console.log(error);
				}
			});//$.ajax

			$('input[value="Sounddatei"]').click(function(){
				$.ajax({
					type: 'GET',
					contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
					dataType: "json",
					data:
					{
						auth: window.localStorage.getItem("auth"),
						couser: window.localStorage.getItem("couserID")
					},
					url: 'https://apiqa.yoummday.com/vacd/soundlist',
					success: function(result){

						console.log('soundlist=>',result);
						delete result["authTime"];
						delete result["success"];

						let ausgabe = $('#ausgabe');
						let ausgabeUL = $('#ausgabe ul');
						ausgabeUL.empty();
						if(Object.keys(result).length > 0) {

							Object.keys(result).forEach(key => {
								if(Object.keys(result[key])){
									Object.keys(result[key]).forEach(index =>{
										if(result[key][index]['filename']){
											let fieleID = result[key][index]["id"];
											let fileName = result[key][index]["filename"];
											let fileTS = result[key][index]["uploadTS"];
											// console.log(fileName);
											let select = $('#soundlist');
											// console.log(select);
											select.append('<option value="' + fieleID + '">' + fileName + '</option>');

											// ausgabeUL.append('<li><input type="checkbox" name="' + fieleID + '" value="' + fileName + '"><label for="'+ fieleID + '"> '+ fileName + '</label><i><small>' + fileTS +'</small></i></li>');

										}else{
											// $("#soundLIST").append('<option value='+ result[key][index]["id"] + '>' + 'keine Name' + '</option>');
										}

									});//Object.keys(result[key]).forEach
								}//if
							});//Object.keys(result)
						}


					},
					error: function(error){
						console.log(error);
					}
				});//$.ajax
			});

			$('input[value="Redirect"]').click(function(){
					$.ajax({
						type:'GET',
						contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
						dataType: 'json',
						data: {
										auth:localStorage.auth,
										couser:localStorage.couserID
									},
						url: 'https://apiqa.yoummday.com/vacd/numberlist',
						success: function(result){
							console.log('numberlist=>',result);
							delete result["authTime"];
							delete result["success"];
							window.localStorage.removeItem('telNr');
							Object.keys(result).forEach(key =>{
								if(result[key]){
									Object.keys(result[key]).forEach(index =>{
										// console.log('result=>',result);
										// console.log('key=>',key);
										// console.log('result[key]=>',result[key]);
										// console.log('result[key][index]=>',result[key][index]); //letzte Update Zeit
										// console.log('index=>',index);
										let select = $('#numlist');
										console.log(select);
										select.append('<option value="' + index + '">' + index + '</option>');
									});//Object.keys(result[key]).forEach
								}//if




							});//Object.keys(result).forEach



						},//success
								error: function(error){
									console.log('error=>',error);
								}
						});//$.ajax

				});
			//beim Abmelden, localStorage leeren
			$('#logout a').click(function(){
				localStorage.clear();
			});

			//#number Container anzeigen
			$('#telNumber').click(function(){
				$('#number').removeClass('hidden');
				$('#divSOUNDUPLOAD').addClass('hidden');
				$('#rightSite').addClass('hidden');
				$('#editorBtn').addClass('hidden');

				//Telnummer auflisten
				$.ajax({
					type:'GET',
					contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
					dataType: 'json',
					data: {
									auth:localStorage.auth,
									couser:localStorage.couserID
								},
					url: 'https://apiqa.yoummday.com/vacd/numberoverview',
					success: function(result){
						// console.log('result=>',result);
						// console.log('result["numberlist"]=>',result['numberlist']);
						console.log('result["temproutinglist"]=>',result['temproutinglist']);
						delete result["authTime"];
						delete result["success"];
						window.localStorage.removeItem('telNr');



						//Tabelle Aufbau und Telefonnummer auflisten
						let tabele = $('#resultat table');
						Object.keys(result).forEach(key =>{
							// console.log('result[key]=>',result[key]);
							// console.log('key=>',key);
							if(key === 'numberlist'){

								//numberlist
								Object.keys(result[key]).forEach(index =>{
									// console.log('result=>',result);
									// console.log('key=>',key);
									// console.log('result[key]=>',result[key]);
									// console.log('result[key][index]=>',result[key][index]['graph']['name']);
									// console.log('index=>',index);

										let select = document.createElement('select');
										select.setAttribute('id',index);
										let option = document.createElement('option');
										option.setAttribute('value',index);
										option.append(result[key][index]['graph']['name']);
										select.append(option);
										let tr = document.createElement('tr');
										let tdTel = document.createElement('td');
										tdTel.setAttribute('width','100%');
										tdTel.setAttribute('style','font-weight:bold');
										let tdClf = document.createElement('td');
										tdClf.setAttribute('width','100%');


										tdClf.append(select);
										tdTel.append(index);
										tr.append(tdTel);
										tr.append(tdClf);
										tabele.append(tr);

										// $("#selectTELNUMMER").append('<option value="' + index + '">' + index + '</option>');

									let telnr = index;
									let graphname = result[key][index]['graph']['name'];
									let graphid = result[key][index]['graph']['id'];

									let ul = $('#zettel');
									let li = document.createElement('li');
									let spanNr = document.createElement('span');
									let spanName = document.createElement('span');
									let spanIcon = document.createElement('span');
									let input = document.createElement('input');
									let label = document.createElement('label');


									label.setAttribute('class','delet');
									label.setAttribute('for','delet');

									input.setAttribute('class','del-item');
									// input.setAttribute('id','delet');
									input.setAttribute('type','submit');
									input.setAttribute('style','display:none');

									spanNr.append(telnr);
									spanName.append(graphname);
									spanIcon.append(label);
									spanIcon.append(input);

									li.setAttribute('class','mb-3');
									li.setAttribute('id',graphid);

									li.append(spanNr);
									li.append(spanName);
									li.append(spanIcon);

									ul.append(li);





								});//Object.keys(result[key]).forEach

							}//if

							if(key === 'temproutinglist' && Object.keys(result[key]).length > 0){
								// temproutinglist
								Object.keys(result[key]).forEach(i =>{

									let tempGrPhone1 = result[key][i]['phone'];
									let tempGrStartTS1 = result[key][i]['startTS'];
									let tempGrID1 = result[key][i]['id'];


									$("#selectTELNUMMER").append('<option value="' + tempGrID1 + '">' + tempGrPhone1 + '</option>');


									if(Object.keys(result[key][i]['graph']).length > 0){

										Object.keys(result[key][i]['graph']).forEach(z=>{

											var tempGrId2 = result[key][i]['graph'][z]['id'];
											let tempGrName2 = result[key][i]['graph'][z]['name'];
											let tempGrJson2 = result[key][i]['graph'][z]['json'];
											let tempGrLastmodifiedTS2 = result[key][i]['graph'][z]['lastmodifiedTS'];

											$("#grafikLIST2").append('<option value="' + tempGrId2 + '">' + tempGrName2 + '</option>');
											console.log(result[key][i]['graph'][z]['id']);
										});

										$("#grafikLIST2").change(function(){

											$('#grafikLIST2 option:selected').each(function(){


												window.localStorage.removeItem('graphJSON');
												window.localStorage.removeItem('graphNAME');
												window.localStorage.removeItem('graphID');
												window.localStorage.removeItem('graphObjTS');

												console.log('this.value=>',this.value);
												// console.log('i=>',i);
												// console.log('result[key]=>',result[key]);
												console.log(result[key][i]['graph']);
												if($(this).val() === result[key][i]['graph'][0]){

															let graphObjID = result[key][i]['graph'][z]['id'];
															let graphObjNAME = result[key][i]['graph'][z]['name']
															let graphObjJSON = result[key][i]['graph'][z]['json']
															let graphObjTS = result[key][i]['graph'][z]['lastmodifiedTS']

															console.log(graphObjNAME);
															window.localStorage.setItem('graphID',graphObjID);
															window.localStorage.setItem('graphNAME',graphObjNAME);
															window.localStorage.setItem('graphObjTS',graphObjTS);


												}//if(result[key])
											});//$('#grafikLIST2 option:selected')
										});//$("#grafikLIST2")

									}
									});
							}

							//Auftrag: Telefonnummer Auswahl
							$("#selectTELNUMMER").change(function(){
								$('#selectTELNUMMER option:selected').each(function(){
									let tr = $('#result');
									let td2 = document.createElement('td');
									td2.setAttribute('id','num');

									// tr.empty();

									if(result[key]){

										Object.keys(result[key]).forEach(i => {

											if(i === this.value){
												console.log(this.text);

												let graphName = result[key][i].graph.name;
												let graphId = result[key][i].graph.id;
												let graphLastModifiedTS = result[key][i].graph.lastmodifiedTS;
												let lastUpdate = result[key][i].lastupdate;
												let graphJson = result[key][i].graph.json;

												window.localStorage.setItem('telNr',this.text);
												let div = $('#liste');
												let p = document.createElement('p');
												p.append(this.text +' ');

												div.append(p);
												// $('#liste ul').empty();
												// $('#liste ul').append('<li>Graphname:<small><i> ' + graphName + '</i></small></li><li> ' + 'GrapID:<small><i> ' + graphId + '</i></small></li><li> ' + 'Letzte Änderung:<small><i> ' + graphLastModifiedTS + '</i></small></li><li> ' + 'Letzte Update:<small><i> ' + lastUpdate + '</i></small></li>');
												$('#result').find('td[id="num"]').remove();
												td2.append(i);
												tr.append(td2);

											}



										});//Object.keys(result[key])
									}//if

								});//$('#selectTELNUMMER option:selected')

							});//$("#selectTELNUMMER")




						});//Object.keys(result).forEach



					},//success
							error: function(error){
								console.log('error=>',error);
							}
					});//$.ajax



			});//$('#telNumber').click


			//Element löschen
			$('#zettel').click(function(e){
				// console.log($(this).closest('li')[0].id);
				// e.preventDefault();

				$('.modal').removeClass('d-none');


				$('button[data-dismiss="modal"]').click(function(){
						$('.modal').addClass('d-none');
				});

				$('#ja').click(function(e){
					// console.log(e);
					var graphid = $('.del-item').closest('li')[0].id;
					console.log(graphid);

					$.ajax({
						type: 'POST',
						contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
						dataType: "json",
						data: {
							auth:window.localStorage['auth'],
							couser:window.localStorage['couserID'],
							routingid:graphid
						},
							url: 'https://apiqa.yoummday.com/vacd/deletetemprouting',

						success: function(data)
						{
							console.log('data=>',data);
							$('.del-item').closest('li').remove();
							$('.modal').addClass('d-none');
							// console.log($(this).closest('li'));
							location.reload();
						},
						error: function(error){
							console.log(error);
						}
					});//$.ajax

				});




			});

			//Anrufverlaufliste mit Telnummer versehen
			$('#hinzu').on('click',function(e){
				let graphid = window.localStorage['graphID'];
				let num = window.localStorage['telNr'];

						$.ajax({
							type:'POST',
							contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
							dataType: 'json',
							data: {
											auth:window.localStorage.getItem("auth"),
											graphid: graphid,
											number: num,
											startTS:'2020-12-10 10:59:59'
										},
							url: 'https://apiqa.yoummday.com/vacd/temprouting',
							success: function(result){
							console.log('result=>',result);

								if(result.success == 1){
									alert('Danke Erfolgreich gespeichert!');
									console.log('geklappt!');
									location.reload();
										let div = $('#liste');
										let p = document.createElement('p');
										p.append(window.localStorage['telNr'] + window.localStorage['graphNAME']) + window.localStorage['graphObjTS'];

										// div.append(p);



								}else{
									console.log(result);
								}

								},
								error: function(error){
									console.log('error=>',error);
								}
						});//$.ajax
			});//$('#hinzufuegen').click
			//.editorbox Container anzeigen
			$('#callflow').click(function(){
				$('#rightSite').removeClass('hidden');
				$('#editorBtn').removeClass('hidden');
				$('#rete').removeClass('hidden');
				$('#number').addClass('hidden');
				$('#divSOUNDUPLOAD').addClass('hidden');





			});//$('#callflow').click


			$("#save").click(function() {
				let graphdata = window.localStorage['savedEditor'];
				console.log('graphdata=>',graphdata);
				let graphname = $("#neueGRAFIKNAME")[0].value;
				console.log('graphname=>',graphname);
				// console.log(this);
				if(graphname != ""){
					$.ajax({
							type: 'POST',
							contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
							dataType: "json",
							data: {
								auth: window.localStorage.getItem("auth"),
								couser: window.localStorage.getItem("couserID"),
								name: graphname,
								json: graphdata
							},
							url: 'https://apiqa.yoummday.com/vacd/submitgraph',
							success: function(responsedata){
								console.log('responsedata=>',responsedata);
								// to do: refresh grafikLIST on the nav leftside
								// location.reload();
								//inputfeld leeren
								$('#neueGRAFIKNAME')[0].value = '';
								// console.log($('#neueGRAFIKNAME')[0].value);
								// $("#submitmessage").fadeIn().fadeOut(2000);


							},
							error: function(error){
								console.log(error);
							}
						});
					} else{
						$("#smallmsg")
						.css("color", "red")
						.text('Name is empty');
					}
				});

			$('#graphLOESCHEN').click(function(){
				// // console.log(this);
				console.log('graphObj1=>',graphObj1);
				let graphID = graphObj1;
				console.log(graphID);
				$.ajax({
					type: 'POST',
					contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
					dataType: "json",
					data: {
						auth:window.localStorage['auth'],
						couser: window.localStorage['couserID'],
						graphid:graphID
					},
						url: 'https://apiqa.yoummday.com/vacd/deletegraph',

					success: function(data)
					{
						console.log(data);
						console.log(data.error);
						location.reload();
						// if(data.error != "nograph" && data.error != "auth"){
						// 	console.log('Erfolgreich gelöscht!');
						// 	location.reload();
						// }else{
						// 	alert('FEHLER');
						// 	console.log(data);
						// }


					},
					error: function(error){
						console.log(error);
					}
				});//$.ajax


			});
			//#divSOUNDUPLOAD Container anzeigen

			$('#sound').click(function(){
				$('#divSOUNDUPLOAD').removeClass('hidden');
				$('#number').addClass('hidden');

				//Hochgeladene Sounds anzeigen
				$.ajax({
					type: 'GET',
					contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
					dataType: "json",
					data:
					{
						auth: window.localStorage.getItem("auth"),
						couser: window.localStorage.getItem("couserID")
					},
					url: 'https://apiqa.yoummday.com/vacd/soundlist',
					success: function(result){

						console.log('result=>',result);
						delete result["authTime"];
						delete result["success"];

						let ausgabe = $('#ausgabe');
						let ausgabeUL = $('#ausgabe ul');
						ausgabeUL.empty();
						if(Object.keys(result).length > 0) {

							Object.keys(result).forEach(key => {
								if(Object.keys(result[key])){
									Object.keys(result[key]).forEach(index =>{
										if(result[key][index]['filename']){
											let fieleID = result[key][index]["id"];
											let fileName = result[key][index]["filename"];
											let fileTS = result[key][index]["uploadTS"];

											ausgabeUL.append('<li><input type="checkbox" name="' + fieleID + '" value="' + fileName + '"><label for="'+ fieleID + '"> '+ fileName + '</label><i><small>' + fileTS +'</small></i></li>');

										}else{
											$("#soundLIST").append('<option value='+ result[key][index]["id"] + '>' + 'keine Name' + '</option>');
										}

									});//Object.keys(result[key]).forEach
								}//if
							});//Object.keys(result)
						}
						// ausgabe.append(deleteBtn);

					},
					error: function(error){
						console.log(error);
					}
				});//$.ajax

				//Sound hochladen
					$('form').on('submit',function (e) {
						e.preventDefault();
						console.log(e);
					});//$('form').on



			});//$('#sound').click(function()

			//sound hochladen
			$('#btnUPLOAD').click(function(){
				var formData = new FormData();
				let auth = localStorage.auth;
				let couser = localStorage.couserID;
				let fileName = $('#inputFILE')[0].files[0].name;

				// console.log('auth=>',auth);
				// console.log('couser=>',couser);
				// console.log('fileName=>',fileName);
				// console.log('file=>',$('#inputFILE')[0].files[0]);
				//
				formData.append("file", $('#inputFILE')[0].files[0]);
				console.log($('#inputFILE')[0].files[0]);
				formData.append('auth',auth);
				formData.append('name',fileName);
					formData.append('couser',couser);
					$.ajax({
						type: 'POST',
						url: 'https://apiqa.yoummday.com/vacd/uploadsound',
						data: formData,
						cache: false,
						contentType: false,
						processData: false,
						success: function(data)
						{
							if(data['error'] !== 'wrongfile'){
								alert('Prima, hochgeladen!');
								console.log('hochgeladen!');
								location.reload();
							}else{
								alert('Datei Type ist falsch! Bitte nur die wav Dateitype hochladen!');
								console.log(data['error']);
							}

							// location.reload();
							// $('#inputFILE')[0].files[0].clear;
							// console.log($('#inputFILE')[0].files[0]);
						},
						error: function(error){
							console.log(error);
						}
					});//$.ajax

			});//$('#btnUPLOAD').click


			//sound löschen
			$('#deleteBtn').click(function(){
				let checkbox = $('input[type="checkbox"]:checked');
				let soundID = checkbox[0].name;
				// console.log(checkbox[0].name);
				$.ajax({
					type: 'POST',
					contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
					dataType: "json",
					data: {
						auth:window.localStorage['auth'],
						soundid:soundID
					},
						url: 'https://apiqa.yoummday.com/vacd/deletesound',

					success: function(data)
					{
						console.log('data=>',data);
						console.log('Erfolgreich gelöscht!');
						// $("#soundLIST").reload;
						location.reload();
					},
					error: function(error){
						console.log(error);
					}
				});//$.ajax
			});//$('#deleteBtn').click







		});//$(document).ready
	</script>
	<script id="rendered-js">

		var numSocket = new Rete.Socket('Number value');

		var VueTimeControl = {
				props: ['readonly', 'emitter', 'ikey', 'getData', 'putData'],
				template: '<input type="time" :readonly="readonly" :value="value" @input="change($event)" @dblclick.stop="" @pointerdown.stop="" @pointermove.stop=""/>',
				data() {
					return {
						value: 0 };

				},
				methods: {
					change(e) {
						this.value = e.target.value;
						this.update();
					},
					update() {
						if (this.ikey)
						this.putData(this.ikey, this.value);
						this.emitter.trigger('process');
					} },

				mounted() {
					this.value = this.getData(this.ikey);
				}
			};

		class TimeControl extends Rete.Control {

				constructor(emitter, key, readonly) {
					super(key);
					this.component = VueTimeControl;
					this.props = { emitter, ikey: key, readonly };
				}

				setValue(val) {
					this.vueContext.value = val;
				}
			}

		var VueDayControl = {
					props: ['readonly', 'emitter', 'ikey', 'getData', 'putData'],
					template: '<select :readonly="readonly" :value="value" @input="change($event)" @dblclick.stop="" @pointerdown.stop="" @pointermove.stop="">\
				<option value="1" selected>Montag</option>\
				<option value="2">Dienstag</option>\
				<option value="3">Mittwoch</option>\
				<option value="4">Donnerstag</option>\
				<option value="5">Freitag</option>\
				<option value="6">Samstag</option>\
				<option value="0">Sonntag</option>\
				</select>',
					data() {
						return {
							value: 0 };

					},
					methods: {
						change(e) {
							this.value = e.target.value;
							this.update();
						},
						update() {
							if (this.ikey)
							this.putData(this.ikey, this.value);
							this.emitter.trigger('process');
						} },

					mounted() {
						this.value = this.getData(this.ikey);
					}
				};

		class DayControl extends Rete.Control {

			constructor(emitter, key, readonly) {
				super(key);
				this.component = VueDayControl;
				this.props = { emitter, ikey: key, readonly };
			}

			setValue(val) {
				this.vueContext.value = val;
			}
		}

		var VueNumControl = {
			props: ['readonly', 'emitter', 'ikey', 'getData', 'putData'],
			template: '<input type="tel" :readonly="readonly" :value="value" @input="change($event)" @dblclick.stop="" @pointerdown.stop="" @pointermove.stop=""/>',
			data() {
				return {
					value: 0 };

			},
			methods: {
				change(e) {
					this.value = +e.target.value;
					this.update();
				},
				update() {
					if (this.ikey)
					this.putData(this.ikey, this.value);
					this.emitter.trigger('process');
				} },

			mounted() {
				this.value = this.getData(this.ikey);
			} };

		class NumControl extends Rete.Control {

			constructor(emitter, key, readonly) {
				super(key);
				this.component = VueNumControl;
				this.props = { emitter, ikey: key, readonly };
			}

			setValue(val) {
				this.vueContext.value = val;
			}}

		var VueStringControl = {
			props: ['readonly', 'emitter', 'skey', 'getData', 'putData'],
			template: '<input type="text" :readonly="readonly" :value="value" @input="change($event)" @dblclick.stop="" @pointerdown.stop="" @pointermove.stop=""/>',
			data() {
				return {
					value: "None" };

			},
			methods: {
				change(e) {
					this.value = e.target.value;
					this.update();
				},
				update() {
					if (this.skey)
					this.putData(this.skey, this.value);
					this.emitter.trigger('process');
				} },

			mounted() {
				this.value = this.getData(this.skey);
			} };

		class StringControl extends Rete.Control {

			constructor(emitter, key, readonly) {
				super(key);
				this.component = VueStringControl;
				this.props = { emitter, skey: key, readonly };
			}

			setValue(val) {
				this.vueContext.value = val;
			}}

		class ProviderComponent extends Rete.Component {

			constructor() {
				super("Provider");
			}

			builder(node) {
				var out1 = new Rete.Output('num', "Provider", numSocket, false);

				// return node.addControl(new NumControl(this.editor, 'num')).addOutput(out1); -->
				return node.addOutput(out1);
			}

			worker(node, inputs, outputs) {
				// outputs['num'] = node.data.num; -->
			}

			}


			var VueRedirectControl ={
				props:['readonly','emitter','ikey','getData','putData'],
				template:'<select id="numlist" :readonly = "readonly" :value = "value" @input="change($event)" @dbclick.stop = "" @pointerdown.stop = "" @pointermove.stop = "">\
				<option value="0" selected>-</option>\
				</select>',
				data(){
					return{value:0};
				},
				methods:{
					change(e){
						this.value = e.target.value;
						this.update();
					},
					update(){
						if(this.ikey)
						this.putData(this.ikey,this.value);
						this.emitter.trigger('process');
					}
				},
				mounted(){this.value = this.getData(this.ikey);}
			};

			class RedirectControl extends Rete.Control{
				constructor(emitter,key,readonly){
					super(key);
					this.component = VueRedirectControl;
					this.props = {emitter,ikey:key,readonly};
				}
				setValue(val){this.vueContext.value = val;}
			}

		class RedirectComponent extends Rete.Component {

			constructor() {
				super("Redirect");
			}

			builder(node) {
				// var out1 = new Rete.Output('num', "Provider", numSocket); -->
			var inp1 = new Rete.Input('num', "In", numSocket, true);
			node.addControl(new RedirectControl(this.editor, 'targetnumber'));
				// return node.addControl(new NumControl(this.editor, 'num')).addOutput(out1); -->
			// node.addControl(new NumControl(this.editor, 'targetnumber'));
			node.addInput(inp1);
				return node;
			}

			worker(node, inputs, outputs) {
				//<!-- outputs['num'] = node.data.num; -->
			}

			}

		class ForceRecordingComponent extends Rete.Component {
			constructor() {
				super("Force Recording");
			}

			builder(node) {
				var inp1 = new Rete.Input('num', "", numSocket, true);
				// var inp2 = new Rete.Input('num2', "Number2", numSocket); -->
				var out = new Rete.Output('num', "", numSocket, false);

				return node.addInput(inp1).addOutput(out);

			}

			worker(node, inputs, outputs) {
				// var n1 = inputs['num'].length ? inputs['num'][0] : node.data.num1; -->
				// var n2 = inputs['num2'].length ? inputs['num2'][0] : node.data.num2; -->
				// var sum = n1 ;//+ n2; -->

				// this.editor.nodes.find(n => n.id == node.id).controls.get('preview').setValue(sum); -->
				// outputs['num'] = sum; -->
			}}

		class PromptUserComponent extends Rete.Component {
			constructor() {
				super("Prompt User");
			}

			builder(node) {
				var inp1 = new Rete.Input('num', "", numSocket, true);

			for (var i=0;i< 10; i++){
				node.addOutput(new Rete.Output('num'+i, ""+i, numSocket, false));
			}

				node.addControl(new StringControl(this.editor, 'path'));
				return node.
				addInput(inp1);
			}

			worker(node, inputs, outputs) {

			}}

		class WeekDayComponent extends Rete.Component {
			constructor() {
				super("Wochentag");
			}

			builder(node) {
				var inp1 = new Rete.Input('num', "", numSocket, true);
				node.addControl(new DayControl(this.editor, 'weekdaystart'));
				node.addControl(new DayControl(this.editor, 'weekdayend'));
				node.addOutput(new Rete.Output('num1', "Richtiger Wochentag", numSocket, false));
				node.addOutput(new Rete.Output('num2', "Falscher Wochentag", numSocket, false));
				return node.
				addInput(inp1);
			}

			worker(node, inputs, outputs) {

			}}

		class TimeComponent extends Rete.Component {
			constructor() {
				super("Uhrzeit");
			}

			builder(node) {
				var inp1 = new Rete.Input('num', "", numSocket, true);
				node.addControl(new TimeControl(this.editor, 'timestart'));
				node.addControl(new TimeControl(this.editor, 'timeend'));
				node.addOutput(new Rete.Output('num1', "Richtige Uhrzeit", numSocket, false));
				node.addOutput(new Rete.Output('num2', "Falsche Uhrzeit", numSocket, false));
				return node.
				addInput(inp1);
			}

			worker(node, inputs, outputs) {

			}}

		var VueSoundControl ={
			props:['readonly','emitter','ikey','getData','putData'],
			template:'<select id="soundlist" :readonly = "readonly" :value = "value" @input="change($event)" @dbclick.stop = "" @pointerdown.stop = "" @pointermove.stop = "">\
			<option value="0" selected>-</option>\
			</select>',
			data(){
				return{value:0};
			},
			methods:{
				change(e){
					this.value = e.target.value;
					this.update();
				},
				update(){
					if(this.ikey)
					this.putData(this.ikey,this.value);
					this.emitter.trigger('process');
				}
			},
			mounted(){this.value = this.getData(this.ikey);}
		};

		class SoundControl extends Rete.Control{
			constructor(emitter,key,readonly){
				super(key);
				this.component = VueSoundControl;
				this.props = {emitter,ikey:key,readonly};
			}
			setValue(val){this.vueContext.value = val;}
		}
		class SoundComponent extends Rete.Component {
			constructor() {
				super("Sounddatei");
			}

			builder(node) {
				var inp1 = new Rete.Input('num', "", numSocket, true);
				node.addControl(new SoundControl(this.editor, 'path'));
				node.addOutput(new Rete.Output('num', "", numSocket, false));
				// node.addControl(new StringControl(this.editor, 'path'));
				return node.
				addInput(inp1);
			}

			worker(node, inputs, outputs) {

			}}

		class SplitComponent extends Rete.Component {
			constructor() {
				super("Verteiler");
			}

			builder(node) {
				var inp1 = new Rete.Input('num', "", numSocket, true);

				node.addOutput(new Rete.Output('num1', "", numSocket, false));
				node.addOutput(new Rete.Output('num2', "", numSocket, false));

				return node.
				addInput(inp1);
			}

			worker(node, inputs, outputs) {

			}}

		var editor;

		var components = [new ProviderComponent(), new ForceRecordingComponent(), new RedirectComponent(), new PromptUserComponent(), new WeekDayComponent(), new TimeComponent(), new SoundComponent(), new SplitComponent()];
		var targ = $("#buttons");
		for (var i = 0; i < components.length; i++) {
			var el = components[i];
			targ.append('<input class="btn btn-outline-primary mb-3" type="button" name="' + i + '" value="' + el.name + '"/><br>');
		}

		$("#buttons input").click(async function(index) {
			console.log(this);
			var n1 = await components[this.name].createNode();
			editor.addNode(n1);
		});

		(async () => {
			var container = document.querySelector('#rete');

			editor = new Rete.NodeEditor('vacd@0.1.0', container);
			editor.use(ConnectionPlugin.default);
			editor.use(VueRenderPlugin.default);
			editor.use(ContextMenuPlugin.default);
			editor.use(AreaPlugin);
			editor.use(CommentPlugin.default);
			editor.use(HistoryPlugin);
			editor.use(ConnectionMasteryPlugin.default);

			var engine = new Rete.Engine('vacd@0.1.0');

			components.map(c => {
				editor.register(c);
				engine.register(c);
			});

			var n1 = await components[0].createNode({
				num: 2
			});
			var n2 = await components[0].createNode({
				num: 0
			});
			var add = await components[1].createNode();

			n1.position = [0, 200];
			//n2.position = [80, 400];-->
			add.position = [200, 240];

			//editor.addNode(n1);
			//editor.addNode(n2);
			//editor.addNode(add);

			//editor.connect(n1.outputs.get('num'), add.inputs.get('num'));
			//editor.connect(n2.outputs.get('num'), add.inputs.get('num2'));

			editor.on('process nodecreated noderemoved connectioncreated connectionremoved nodetranslated', async (e) => {
				console.log("process");
				//<!--console.log(editor.toJSON());-- >
				await engine.abort();
				await engine.process(editor.toJSON());
				window.localStorage.setItem('savedEditor', JSON.stringify(editor.toJSON()));

			});

			// var savedEditor = window.localStorage.getItem("savedEditor");
			// if (savedEditor) {
			// 	editor.fromJSON(JSON.parse(savedEditor));
			// }

			editor.trigger('process');
			editor.view.resize();
			AreaPlugin.zoomAt(editor);
		})();

		$("#generator").click(function() {
			$("#out").text(JSON.stringify(editor.toJSON()));
			for (var i = 0; i < editor.nodes.length; i++) {
				var node = editor.nodes[i];
				var allconnected = true;
				for (let value of node.outputs.values()) {
					if (value.connections.length == 0) {
						allconnected = false;
					}
				}
				console.log('allconnected=>',allconnected);
				if (!allconnected) {
					$(node.vueContext.$el)
					.css("background", "red")
					.fadeOut(100)
					.fadeIn(100)
					.fadeOut(100)
					.fadeIn(100);
					// editor.trigger("addcomment", ("frame",  "Not connected", node));
				}
			}
		});





	</script>

</body>
</html>
<!DOCTYPE html>
<html>
<head>
	<title>VACD</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" type="image/png" sizes="32x32" href="meta/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="meta/favicon-16x16.png">
	<link rel="icon" type="image/png" href="meta/favicon.ico">
	<link rel="mask-icon" href="meta/safari-pinned-tab.svg" color="#ce470a">
	<link rel="stylesheet" type="text/css" href="css/_plug/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/forms.css">
	<link rel="stylesheet" type="text/css" href="css/yd.css">

	<style>
		table,
		th,
		td {
			/* border: 1px solid black; */
			border-collapse: collapse;
			width: 100%;
		}
		#rete{
			overflow: hidden;
			touch-action: none;
			width: 100% !important;
			height: 70vh;
		}

		#buttons,.buttons{
			display: flex;
			justify-content: start;
			flex-direction: row;
			width: 100%;
		}
		.node .red {
			background: red;
		}
		.extBtn{
			display: flex;
			flex-direction: column;
			justify-content: space-between;
			align-content: stretch;
		}
		/*#extBtn input:first-child{
			margin-right: 10px;
		} */
		.saveBtn,.hinzufuegenBTN{
			display: flex;
			justify-content: center;
			align-items: center;
			margin-top: 10px;
		}
		.smallmsg{
			position: absolute;
			left: auto;
			right: auto;
			top: 60px;
			margin-left: 5px;
		}
		.progress-bar{
			margin-top: 10px;
			height: 35px;
		}
		.progress-bar-fill{
			height: 100%;
			width: 0%;
			background: lightblue;
			display: flex;
			align-items: center;
			transition: width 0.25s;
		}
		.progress-bar-text{
			margin-left: 5px;
			font-weight: bold;

		}
		#dropZone{
			border: 3px dashed #fd7e14;
			padding: 10px;
			width: 100%;
			height: auto;

		}
		#dropZone>span{
			display: block;
			text-align: center;
			color: #244669;
		}
		#dropZone>span,
		#fileUPLOAD{
			height: 35px;
			line-height: 35px;
			color: #244669;
		}
		#files{
			border:1px dotted #0088cc;
			padding:20px;
			width:100%;
			display: none;
		}
		#fileUPLOAD{
			position: relative;
			opacity: 1;
			filter: alpha(opacity=1);
			width: 100%;

		}
		#error{
			color:red;
			margin-top:10px;
		}
		#progress{
			height: 100%;
			width: 0%;
			background: lightblue;
			display: flex;
			align-items: center;
			transition: width 0.25s;
		}
		#inputFILE{
			position: relative;
			opacity: 1;
			filter: alpha(opacity=0);
			width: 100%;
			height: 35px;
			line-height: 35px;
		}



					.clock {
						width: 260px;
						margin: 0 auto;
						padding: 30px;
						color: #FFF;background:#333;
						}
						.clock ul {
						width: 250px;
						margin: 0 auto;
						padding: 0;
						list-style: none;
						text-align: center
						}

						.clock ul li {
						display: inline;
						font-size: 3em;
						text-align: center;
						font-family: "Arial", Helvetica, sans-serif;
						text-shadow: 0 2px 5px #55c6ff, 0 3px 6px #55c6ff, 0 4px 7px #55c6ff
						}
						#Date {
						font-family: 'Arial', Helvetica, sans-serif;
						font-size: 26px;
						text-align: center;
						text-shadow: 0 2px 5px #55c6ff, 0 3px 6px #55c6ff;
						padding-bottom: 40px;
						}
						#point {
							position: relative;
							-moz-animation: mymove 1s ease infinite;
							-webkit-animation: mymove 1s ease infinite;
							padding-left: 10px;
							padding-right: 10px
							}

							/* Animasi Detik Kedap - Kedip */
							@-webkit-keyframes mymove
							{
							0% {opacity:1.0; text-shadow:0 0 20px #00c6ff;}
							50% {opacity:0; text-shadow:none; }
							100% {opacity:1.0; text-shadow:0 0 20px #00c6ff; }
							}

							@-moz-keyframes mymove
							{
							0% {opacity:1.0; text-shadow:0 0 20px #00c6ff;}
							50% {opacity:0; text-shadow:none; }
							100% {opacity:1.0; text-shadow:0 0 20px #00c6ff; }
							}

	</style>

</head>
<body translate="no">
	<article class="row no-gutters">
		<aside class="col-auto">
			<a href="/" class="logo bone"><div></div></a>
			<nav class="bone" id="nav">
					<!-- <a href="#" id="grafikSPEICHERN" >Save Graph</a>
					<a href="#" id="telnummerHINZUFUEGEN" >Update Graph</a> -->
					<!-- <h4><b>Meine Graphen</b></h4> -->
					<!-- <input type="button" class="btn btn-outline-primary mt-3" id="generator" value="Generate" />
					<input type="button" class="btn btn-outline-primary mt-3" id="grafikSPEICHERN" value="Save Graph" />
					<input type="button" class="btn btn-outline-primary mt-3" id="telnummerHINZUFUEGEN" value="Telnummer Update" /> -->
			</nav>
			<footer>
				<nav class="bone">
					<a href="index.html" id="logout">abmelden</a>
					<!-- <a href="#" id="test">TEST</a> -->
					<a href="#" id="generator">Generate</a>
				</nav>

				<small>
					currentVersion&nbsp;
					<a href="#" onclick="location.reload(true)">
						<img src="//assets.yoummday.com/icons/mdi-reload.svg?color=%23eb6608" style="width:16px;">
					</a>
				</small>
			</footer>
		</aside>
		<div class="col row no-gutters flex-column">
			<header class="bone text-center">
				<div class="row">
					<div class="col-xs-6 col-md-4">
						<div class="row">
							<div class="col-xs-6 col-md-4 p-2">
								<!-- <span class="text-muted"><label for="worktype_label">HEADER</label></span> -->
							</div>
							<div class="col-xs-12 col-sm-6 col-md-8 p-2 text-left">
								<span class="font-weight-bold text-uppercase "><label id="worktype_label">EDITOR</label></span>
							</div>
						</div>
					</div>
					<div class="col-xs-12 col-sm-6 col-md-8"></div>
				</div>
			</header>
			<div class="content col">
				<div class="row justify-content-around" >
					<div id="buttons"></div>
				</div>
				<div class="row justify-content-around">
					<div class="card col-sm-6 col-md-9">
						<div class="card-body">
							<div id="rete"></div>
						</div>
					</div>
					<div class="card col-4 col-md-3 p-3" >
						<div class="card-body justify-content-around">
								<div class="col" id="divGRAFIKLIST">
									<label for="grafikLIST">Gespeicherte Grafiken</label>
									<select id="grafikLIST" class="grafikLIST" name="grafikLIST" >
										<option value="#">--</option>
									</select>
									<div class=" card-head clock">
			 							<div id="Date"></div>
				 						<ul>
					 						<li id="hours"></li>
					 						<li id="point">:</li>
					 						<li id="min"></li>
					 						<li id="point">:</li>
					 						<li id="sec"></li>
				 						</ul>
			 						</div>
								</div><!-- divGRAFIKLIST-->
								<div class="col extBtn">
										<input type="button" class="btn btn-primary mt-3 " id="grafikSPEICHERN" value="Follow speichern" />
								</div>
								<div class="col hidden" id="divGRAFIKNAME">
											<label for="neueGRAFIKNAME">Grafikname:</label>
											<input type="text" name="neueGRAFIKNAME" id="neueGRAFIKNAME" value=""/>
											<p class="smallmsg"><small id="smallmsg"></small></p>
											<input type="button" class="btn btn-small btn-primary mt-3 mb-3" id="save" value="speichern" />
								</div><!-- divGRAFIKNAME-->
								<div class="col extBtn">
										<input type="button" class="btn btn-primary mt-3" id="telnummerHINZUFUEGEN" value="Telnummer hinzufügen" />
								</div>
								<div class="col hidden" id='divTELNUMMER'>
											<label for="selectTELNUMMER">Telfonnummer:</label>
											<select id="selectTELNUMMER" size="">
												<option value="#" selected>--</option>
											</select>
											<input type="submit" class="btn btn-small btn-primary mt-3" id="hinzufuegen" value="hinzufügen" />
								</div><!-- divTELNUMMER-->
								<div class="col extBtn mt-5">
									<form id="uploadFORM" enctype='multipart/form-data'>
										<input type="file" name="file" value="" id="inputFILE"><br>
										<input type="button" class="button btn btn-primary" value="UPLOAD" id="btnUPLOAD">
									</form>
								</div><!-- soundUPLOAD -->
							</div><!-- card-body-->
					</div>
					<div class="text">
						<div id="out" class="mb-3"></div>
						<div id="ausgabe" class="col-sm-6 col-md-10 mb-3"><ul></ul></div>
					</div>
					<!-- <div class="text-center">
						<input type="button" class="btn btn-outline-primary mt-3" id="generator" value="Generate" />
						<input type="button" class="btn btn-outline-primary mt-3" id="grafikSPEICHERN" value="Save Graph" />
						<input type="button" class="btn btn-outline-primary mt-3" id="telnummerHINZUFUEGEN" value="Telnummer Update" />
					</div> -->
				</div>
			</div>
		</div>
	</article>

	<script src="./js/rete.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.6/vue.min.js"></script>
	<script src="./js/vue-render-plugin.min.js"></script>
	<script src="./js/connection-plugin.min.js"></script>
	<script src="./js/alight.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.11/lodash.min.js"></script>
	<script src="./js/context-menu-plugin.min.js"></script>
	<script src="./js/area-plugin.min.js"></script>
	<script src="./js/comment-plugin.min.js"></script>
	<script src="./js/history-plugin.min.js"></script>
	<script src="./js/connection-mastery-plugin.min.js"></script>
	<script src="./js/jquery-3.5.1.js"></script>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
	<script src="./js/jq/vendor/jquery.ui.widget.js"></script>
	<script src="./js/jq/jquery.iframe-transport.js"></script>
	<script src="./js/jq/jquery.fileupload.js"></script>

	<script type="text/javascript">

		$(document).ready(function(){
			$.ajax({
				type: 'POST',
				contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
				dataType: "json",
				data:
				{
					auth: window.localStorage.getItem("auth"),
					couser: window.localStorage.getItem("couserID")
				},
				url: 'https://apiqa.yoummday.com/vacd/couserslist',
				success: function(result){
					// console.log('graphObj=>',graphObj);
					// console.log('result=>',result);
					delete result["authTime"];
					delete result["success"];
					if(window.localStorage.getItem('name')){
						let nav = $('#nav');
						let a = document.createElement('a');
						a.setAttribute('href','#');
						a.appendChild(document.createTextNode(window.localStorage['name']));
						nav.append(a);
						console.log(nav);
					}
				},
				error: function(error){
					console.log(error);
				}
			});//$.ajax
			var graphObj;
			$.ajax({
					type: 'GET',
					contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
					dataType: "json",
					data:
					{
						auth: window.localStorage.getItem("auth"),
						couser: window.localStorage.getItem("couserID")
					},
					url: 'https://apiqa.yoummday.com/vacd/graphlist',
					success: function(result){
						// console.log('graphObj=>',graphObj);
						// console.log('result=>',result);
						delete result["authTime"];
						delete result["success"];

						if(Object.keys(result).length > 0) {

							Object.keys(result).forEach(key => {

								if(Object.keys(result[key]).length > 0){
									Object.keys(result[key]).forEach(i => {
										$("#grafikLIST").append('<option value='+ result[key][i]["id"] + '>' + result[key][i]["name"] + '</option>');
									}//Object.keys

								)}//if


								$("#grafikLIST").change(function(){
									graphObj = "";
									$('#grafikLIST option:selected').each(function(){
										if(Object.keys(result[key]).length > 0){
											Object.keys(result[key]).forEach(i => {
												console.log(result[key]);
												console.log(result[key][i]);
												graphObj = result[key];
												let graphObjID = result[key][i].id;
												let graphObjNAME = result[key][i].name;
												let graphObjJSON = result[key][i].json;
												// console.log(result[key].json);
												let json = result[key][i].json;
												editor.fromJSON( JSON.parse(json));
												// $('#ausgabe ul').empty();
												// $('#ausgabe ul').append('<li> ' + 'ID: ' + graphObjID + '</li><li>' + 'NAME: ' + graphObjNAME + '</li><li>' + 'JSON: ' + graphObjJSON + '</li>');

											});
											}
									});//$('#grafikLIST option:selected')
								});//$("#grafikLIST")
							});//Object.keys(result)
						}

					},
					error: function(error){
						console.log(error);
					}
				});//$.ajax
				// console.log('graphObj=>',graphObj);
			//FUNCTIONEN
			function telNummerliste(){
							$.ajax({
								type:'GET',
								contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
								dataType: 'json',
								data: {
												auth:localStorage.auth,								//"qaib2r73g865j8dsnw609HVpSzt_sYP4ceUEfr2TPxIKknBQ6XTujR93FnhdBbX",
												// couser:localStorage.couserID
											},
								url: 'https://apiqa.yoummday.com/vacd/numberlist',
								success: function(result){
									delete result["authTime"];
									delete result["success"];
									console.log(result);
									Object.keys(result).forEach(key =>{
										console.log(key);
										if(result[key].length > 0){
											console.log(result[key]);
											for(let i=0; i<result[key].length;i++){
												console.log(i);
												$("#selectTELNUMMER").append('<option value="' + i + '">' + result[key][i] + '</option>');
											}
										}
									});
								},
									error: function(error){
										console.log('error=>',error);
									}
							});//graph
						}
			function graphID(p){
							let gID;
							let graphdata = JSON.stringify(editor.toJSON());
							console.log(graphdata);
							$( "#grafikLIST" ).change(function () {
								gID = "";
								$( "#grafikLIST option:selected" ).each(function() {
									gID += $( this ).val();
									console.log(this)

									$(this).text(JSON.stringify(editor.toJSON()));
								});
								p = gID;
							})
							.change();

							console.log('pID=>',p);
							return p;
						}
			function telNumwahl(p){
							let tNum;
							$( "#selectTELNUMMER" ).change(function () {
								tNum = "";
								$( "#selectTELNUMMER option:selected" ).each(function() {
									tNum += $( this ).text();
								});
								p = tNum;
							})
							.change();
							console.log('pNum=>',p);
							return p;
						}

			// CLICK EVENTS //
			//Grafik speichern
			$("#grafikSPEICHERN").click(function() {
							$(this).addClass('hidden');
							$("#divGRAFIKNAME").removeClass("hidden");
							let graphdata = JSON.stringify(editor.toJSON());
							// console.log('graphdata=>',graphdata);
							let graphname = $("#neueGRAFIKNAME");
							$("#save").click(function() {
								if(graphname.val() != ""){
									$.ajax({
											type: 'POST',
											contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
											dataType: "json",
											data: {
												auth: window.localStorage.getItem("auth"),
												couser: window.localStorage.getItem("couserID"),
												name: graphname.val(),
												json: graphdata
											},
											url: 'https://apiqa.yoummday.com/vacd/submitgraph',
											success: function(responsedata){
												$("#divGRAFIKNAME").addClass("hidden");
												$("#grafikSPEICHERN").removeClass('hidden');
												// to do: refresh grafikLIST on the nav leftside
												// console.log(responsedata);
												location.reload();
												//inputfeld leeren
												graphname.val('');
												// $("#submitmessage").fadeIn().fadeOut(2000);


											},
											error: function(error){
												$("#divGRAFIKNAME").addClass("hidden");
												console.log(error);
											}
										});
									} else{
										$("#smallmsg")
										.css("color", "red")
										.text('Name is empty');
									}
								});
						});//#grafikSPEICHERN

			//Telefonnummer hinzufügen
			$('#telnummerHINZUFUEGEN').click(function(){
							$(this).addClass('hidden');
							$('#divTELNUMMER').removeClass('hidden');
							telNummerliste();
							var graphid = graphID(graphid);
							console.log('graphid=>',graphid);

							$('#hinzufuegen').click(function(){
								var num = telNumwahl(num);
								console.log('num=>',num);
									$.ajax({
										type:'POST',
										contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
										dataType: 'json',
										data: {
														auth:window.localStorage.getItem("auth"),				//"qaib2r73g865j8dsnw609HVpSzt_sYP4ceUEfr2TPxIKknBQ6XTujR93FnhdBbX",
														graphid: graphid,
														number: num
													},
										url: 'https://apiqa.yoummday.com/vacd/graph',
										success: function(result){
												$('#telnummerHINZUFUEGEN').removeClass('hidden');
												console.log('geklappt!');
												location.reload();

											},
											error: function(error){
												console.log('error=>',error);
											}
									});//graph
									$('#divTELNUMMER').addClass('hidden');
							});//$('#hinzufuegen').click
						});//#telnummerHINZUFUEGEN

			//Sound hochladen
				$('form').on('submit',function (e) {
					e.preventDefault();
				});//$('form').on
				$('#btnUPLOAD').click(function(){
					var formData = new FormData();
					let auth = localStorage.auth;
					let couser = localStorage.couserID;
					let fileName = $('#inputFILE')[0].files[0].name;

					console.log('auth=>',auth);
					console.log('couser=>',couser);
					console.log('fileName=>',fileName);
					console.log('file=>',$('#inputFILE')[0].files[0]);

					formData.append("file", $('#inputFILE')[0].files[0]);
					formData.append('auth',auth);
					formData.append('name',fileName);
					if(couser !== "undefined"){
						formData.append('couser',couser);
						$.ajax({
							type: 'POST',
							url: 'https://apiqa.yoummday.com/vacd/uploadsound',
							data: formData,
							cache: false,
							contentType: false,
							processData: false,
							success: function(data)
							{
								console.log('data=>',data);
								console.log(localStorage.couserID);
							}
						});//$.ajax
					}else{
						// window.localStorage.removeItem('couserID');
						// formData.append('couser',null);
						// formData.delete('couser');
						$.ajax({
							type: 'POST',
							url: 'https://apiqa.yoummday.com/vacd/uploadsound',
							data: formData,
							cache: false,
							contentType: false,
							processData: false,
							success: function(data)
							{
								console.log('data=>',data);
								console.log(localStorage.couserID);
							}
						});//$.ajax

					}

					console.log('couser=>',couser);
					console.log(formData);
				});//$('#btnUPLOAD').click




				//Aktuelle Uhrzeit
				// Making 2 variable month and day
				var monthNames = [ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" ];
				var dayNames= ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]

				// make single object
				var newDate = new Date();
				// make current time
				newDate.setDate(newDate.getDate());
				// setting date and time
				$('#Date').html(dayNames[newDate.getDay()] + " " + newDate.getDate() + ' ' + monthNames[newDate.getMonth()] + ' ' + newDate.getFullYear());

				setInterval( function() {
				// Create a newDate() object and extract the seconds of the current time on the visitor's
				var seconds = new Date().getSeconds();
				// Add a leading zero to seconds value
				$("#sec").html(( seconds < 10 ? "0" : "" ) + seconds);
				},1000);

				setInterval( function() {
				// Create a newDate() object and extract the minutes of the current time on the visitor's
				var minutes = new Date().getMinutes();
				// Add a leading zero to the minutes value
				$("#min").html(( minutes < 10 ? "0" : "" ) + minutes);
				},1000);

				setInterval( function() {
				// Create a newDate() object and extract the hours of the current time on the visitor's
				var hours = new Date().getHours();
				// Add a leading zero to the hours value
				$("#hours").html(( hours < 10 ? "0" : "" ) + hours);
				}, 1000);





















			$('#test').click(function(){
							// $('#rete').empty();


			});
		});//$(document).ready
	</script>
	<script id="rendered-js">

		var numSocket = new Rete.Socket('Number value');

		var VueTimeControl = {
			  props: ['readonly', 'emitter', 'ikey', 'getData', 'putData'],
			  template: '<input type="time" :readonly="readonly" :value="value" @input="change($event)" @dblclick.stop="" @pointerdown.stop="" @pointermove.stop=""/>',
			  data() {
			    return {
			      value: 0 };

			  },
			  methods: {
			    change(e) {
			      this.value = e.target.value;
			      this.update();
			    },
			    update() {
			      if (this.ikey)
			      this.putData(this.ikey, this.value);
			      this.emitter.trigger('process');
			    } },

			  mounted() {
			    this.value = this.getData(this.ikey);
			  }
			};

		class TimeControl extends Rete.Control {

			  constructor(emitter, key, readonly) {
			    super(key);
			    this.component = VueTimeControl;
			    this.props = { emitter, ikey: key, readonly };
			  }

			  setValue(val) {
			    this.vueContext.value = val;
			  }
			}

		var VueDayControl = {
				  props: ['readonly', 'emitter', 'ikey', 'getData', 'putData'],
				  template: '<select :readonly="readonly" :value="value" @input="change($event)" @dblclick.stop="" @pointerdown.stop="" @pointermove.stop="">\
				<option value="1" selected>Montag</option>\
				<option value="2">Dienstag</option>\
				<option value="3">Mittwoch</option>\
				<option value="4">Donnerstag</option>\
				<option value="5">Freitag</option>\
				<option value="6">Samstag</option>\
				<option value="0">Sonntag</option>\
				</select>',
				  data() {
				    return {
				      value: 0 };

				  },
				  methods: {
				    change(e) {
				      this.value = e.target.value;
				      this.update();
				    },
				    update() {
				      if (this.ikey)
				      this.putData(this.ikey, this.value);
				      this.emitter.trigger('process');
				    } },

				  mounted() {
				    this.value = this.getData(this.ikey);
				  }
				};

		class DayControl extends Rete.Control {

		  constructor(emitter, key, readonly) {
		    super(key);
		    this.component = VueDayControl;
		    this.props = { emitter, ikey: key, readonly };
		  }

		  setValue(val) {
		    this.vueContext.value = val;
		  }
		}

		var VueNumControl = {
		  props: ['readonly', 'emitter', 'ikey', 'getData', 'putData'],
		  template: '<input type="tel" :readonly="readonly" :value="value" @input="change($event)" @dblclick.stop="" @pointerdown.stop="" @pointermove.stop=""/>',
		  data() {
		    return {
		      value: 0 };

		  },
		  methods: {
		    change(e) {
		      this.value = +e.target.value;
		      this.update();
		    },
		    update() {
		      if (this.ikey)
		      this.putData(this.ikey, this.value);
		      this.emitter.trigger('process');
		    } },

		  mounted() {
		    this.value = this.getData(this.ikey);
		  } };

		class NumControl extends Rete.Control {

		  constructor(emitter, key, readonly) {
		    super(key);
		    this.component = VueNumControl;
		    this.props = { emitter, ikey: key, readonly };
		  }

		  setValue(val) {
		    this.vueContext.value = val;
		  }}

		var VueStringControl = {
		  props: ['readonly', 'emitter', 'skey', 'getData', 'putData'],
		  template: '<input type="text" :readonly="readonly" :value="value" @input="change($event)" @dblclick.stop="" @pointerdown.stop="" @pointermove.stop=""/>',
		  data() {
		    return {
		      value: "None" };

		  },
		  methods: {
		    change(e) {
		      this.value = e.target.value;
		      this.update();
		    },
		    update() {
		      if (this.skey)
		      this.putData(this.skey, this.value);
		      this.emitter.trigger('process');
		    } },

		  mounted() {
		    this.value = this.getData(this.skey);
		  } };

		class StringControl extends Rete.Control {

		  constructor(emitter, key, readonly) {
		    super(key);
		    this.component = VueStringControl;
		    this.props = { emitter, skey: key, readonly };
		  }

		  setValue(val) {
		    this.vueContext.value = val;
		  }}

		class ProviderComponent extends Rete.Component {

		  constructor() {
		    super("Provider");
		  }

		  builder(node) {
		    var out1 = new Rete.Output('num', "Provider", numSocket, false);

		    // return node.addControl(new NumControl(this.editor, 'num')).addOutput(out1); -->
		    return node.addOutput(out1);
		  }

		  worker(node, inputs, outputs) {
		    // outputs['num'] = node.data.num; -->
		  }

		  }


		class RedirectComponent extends Rete.Component {

		  constructor() {
		    super("Redirect");
		  }

		  builder(node) {
		    // var out1 = new Rete.Output('num', "Provider", numSocket); -->
			var inp1 = new Rete.Input('num', "In", numSocket, true);
		    // return node.addControl(new NumControl(this.editor, 'num')).addOutput(out1); -->
			node.addControl(new NumControl(this.editor, 'targetnumber'));
			node.addInput(inp1);
		    return node;
		  }

		  worker(node, inputs, outputs) {
		    //<!-- outputs['num'] = node.data.num; -->
		  }

		  }

		class ForceRecordingComponent extends Rete.Component {
		  constructor() {
		    super("Force Recording");
		  }

		  builder(node) {
		    var inp1 = new Rete.Input('num', "", numSocket, true);
		    // var inp2 = new Rete.Input('num2', "Number2", numSocket); -->
		    var out = new Rete.Output('num', "", numSocket, false);

		    return node.addInput(inp1).addOutput(out);

		  }

		  worker(node, inputs, outputs) {
		    // var n1 = inputs['num'].length ? inputs['num'][0] : node.data.num1; -->
		    // var n2 = inputs['num2'].length ? inputs['num2'][0] : node.data.num2; -->
		    // var sum = n1 ;//+ n2; -->

		    // this.editor.nodes.find(n => n.id == node.id).controls.get('preview').setValue(sum); -->
		    // outputs['num'] = sum; -->
		  }}

		class PromptUserComponent extends Rete.Component {
		  constructor() {
		    super("Prompt User");
		  }

		  builder(node) {
		    var inp1 = new Rete.Input('num', "", numSocket, true);

			for (var i=0;i< 10; i++){
				node.addOutput(new Rete.Output('num'+i, ""+i, numSocket, false));
			}

		    node.addControl(new StringControl(this.editor, 'path'));
		    return node.
		    addInput(inp1);
		  }

		  worker(node, inputs, outputs) {

		  }}

		class WeekDayComponent extends Rete.Component {
		  constructor() {
		    super("Wochentag");
		  }

		  builder(node) {
		    var inp1 = new Rete.Input('num', "", numSocket, true);
		    node.addControl(new DayControl(this.editor, 'weekdaystart'));
		    node.addControl(new DayControl(this.editor, 'weekdayend'));
		    node.addOutput(new Rete.Output('num1', "Richtiger Wochentag", numSocket, false));
		    node.addOutput(new Rete.Output('num2', "Falscher Wochentag", numSocket, false));
		    return node.
		    addInput(inp1);
		  }

		  worker(node, inputs, outputs) {

		  }}

		class TimeComponent extends Rete.Component {
		  constructor() {
		    super("Uhrzeit");
		  }

		  builder(node) {
		    var inp1 = new Rete.Input('num', "", numSocket, true);
		    node.addControl(new TimeControl(this.editor, 'timestart'));
		    node.addControl(new TimeControl(this.editor, 'timeend'));
		    node.addOutput(new Rete.Output('num1', "Richtige Uhrzeit", numSocket, false));
		    node.addOutput(new Rete.Output('num2', "Falsche Uhrzeit", numSocket, false));
		    return node.
		    addInput(inp1);
		  }

		  worker(node, inputs, outputs) {

		  }}

		class SoundComponent extends Rete.Component {
		  constructor() {
		    super("Sounddatei");
		  }

		  builder(node) {
		    var inp1 = new Rete.Input('num', "", numSocket, true);

		    node.addOutput(new Rete.Output('num', "", numSocket, false));
		    node.addControl(new StringControl(this.editor, 'path'));
		    return node.
		    addInput(inp1);
		  }

		  worker(node, inputs, outputs) {

		  }}






		class SplitComponent extends Rete.Component {
		  constructor() {
		    super("Verteiler");
		  }

		  builder(node) {
		    var inp1 = new Rete.Input('num', "", numSocket, true);

		    node.addOutput(new Rete.Output('num1', "", numSocket, false));
		    node.addOutput(new Rete.Output('num2', "", numSocket, false));

		    return node.
		    addInput(inp1);
		  }

		  worker(node, inputs, outputs) {

		  }}

		var editor;

		var components = [new ProviderComponent(), new ForceRecordingComponent(), new RedirectComponent(), new PromptUserComponent(), new WeekDayComponent(), new TimeComponent(), new SoundComponent(), new SplitComponent()];
		var targ = $("#buttons");
		for (var i = 0; i < components.length; i++) {
			var el = components[i];
			targ.append('<input class="btn btn-outline-primary mb-3" type="button" name="' + i + '" value="' + el.name + '"/><br>');
		}

		$("#buttons input").click(async function(index) {
			console.log(this);
			var n1 = await components[this.name].createNode();
			editor.addNode(n1);
		});

		(async () => {
			var container = document.querySelector('#rete');

			editor = new Rete.NodeEditor('vacd@0.1.0', container);
			editor.use(ConnectionPlugin.default);
			editor.use(VueRenderPlugin.default);
			editor.use(ContextMenuPlugin.default);
			editor.use(AreaPlugin);
			editor.use(CommentPlugin.default);
			editor.use(HistoryPlugin);
			editor.use(ConnectionMasteryPlugin.default);

			var engine = new Rete.Engine('vacd@0.1.0');

			components.map(c => {
				editor.register(c);
				engine.register(c);
			});

			var n1 = await components[0].createNode({
				num: 2
			});
			var n2 = await components[0].createNode({
				num: 0
			});
			var add = await components[1].createNode();

			n1.position = [0, 200];
			//n2.position = [80, 400];-->
			add.position = [200, 240];

			//editor.addNode(n1);
			//editor.addNode(n2);
			//editor.addNode(add);

			//editor.connect(n1.outputs.get('num'), add.inputs.get('num'));
			//editor.connect(n2.outputs.get('num'), add.inputs.get('num2'));

			editor.on('process nodecreated noderemoved connectioncreated connectionremoved nodetranslated', async (e) => {
				console.log("process");
				//<!--console.log(editor.toJSON());-- >
				await engine.abort();
				await engine.process(editor.toJSON());
				window.localStorage.setItem('savedEditor', JSON.stringify(editor.toJSON()));

			});

			var savedEditor = window.localStorage.getItem("savedEditor");
			if (savedEditor) {
				editor.fromJSON(JSON.parse(savedEditor));
			}

			editor.trigger('process');
			editor.view.resize();
			AreaPlugin.zoomAt(editor);
		})();

		$("#generator").click(function() {
			$("#out").text(JSON.stringify(editor.toJSON()));
			for (var i = 0; i < editor.nodes.length; i++) {
				var node = editor.nodes[i];
				var allconnected = true;
				for (let value of node.outputs.values()) {
					if (value.connections.length == 0) {
						allconnected = false;
					}
				}
				console.log('allconnected=>',allconnected);
				if (!allconnected) {
					$(node.vueContext.$el)
					.css("background", "red")
					.fadeOut(100)
					.fadeIn(100)
					.fadeOut(100)
					.fadeIn(100);
					// editor.trigger("addcomment", ("frame",  "Not connected", node));
				}
			}
		});





	</script>

</body>
</html>